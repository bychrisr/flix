# Story 7.3: Learner App Runtime with Catalog and Playback

## Status
Review

## Executor Assignment
executor: "@dev"
quality_gate: "@architect"
quality_gate_tools: ["manual-review"]

## Story
**As a** learner,  
**I want** a real learner-facing web application,  
**so that** I can navigate catalog and consume lessons in a production-like flow.

## Acceptance Criteria
1. Learner app runs with framework runtime and consumes public catalog/access APIs.
2. Catalog and lesson playback flows reflect release/private access states correctly.
3. Navigation between lessons and access messaging is clear and consistent.

## Tasks / Subtasks
- [x] Task 1 (AC: 1) Learner app runs with framework runtime and consumes public catalog/access APIs.
  - [x] Implement technical changes required for AC 1
  - [x] Add validation/tests for AC 1
- [x] Task 2 (AC: 2) Catalog and lesson playback flows reflect release/private access states correctly.
  - [x] Implement technical changes required for AC 2
  - [x] Add validation/tests for AC 2
- [x] Task 3 (AC: 3) Navigation between lessons and access messaging is clear and consistent.
  - [x] Implement technical changes required for AC 3
  - [x] Add validation/tests for AC 3

## Dev Notes
### Previous Story Insights
- Use previous completed story notes when available.

### Data Models
- Use the domain entities from architecture shards when applicable to this story.
  [Source: docs/architecture/data-models.md#Data Models]

### API Specifications
- Follow REST contracts and endpoint boundaries from API specification shards.
  [Source: docs/architecture/api-specification.md#API Specification]

### File Locations
- Respect monorepo boundaries (`apps/web`, `apps/admin`, `services/api`, `packages/design-system`).
  [Source: docs/architecture/unified-project-structure.md#Unified Project Structure]

### Technical Constraints
- Keep implementation aligned with selected stack and architecture patterns.
  [Source: docs/architecture/tech-stack.md#Tech Stack]
  [Source: docs/architecture/high-level-architecture.md#High Level Architecture]

### Service Specifications
- Follow backend module organization and auth/security middleware patterns.
  [Source: docs/architecture/backend-architecture.md#Backend Architecture]
  [Source: docs/architecture/security-and-performance.md#Security and Performance]

- Story source: docs/prd/epic-7-frontend-delivery-web-and-admin-apps.md

## Testing
- Follow test pyramid and organization from architecture testing strategy.
  [Source: docs/architecture/testing-strategy.md#Testing Strategy]
- Add/update unit tests for new business logic.
- Add/update integration tests for modified API flows when applicable.
- Ensure critical journey impact is considered for E2E smoke coverage.

## ðŸ¤– CodeRabbit Integration

> **CodeRabbit Integration**: Disabled
>
> CodeRabbit CLI is not enabled in `core-config.yaml`.
> Quality validation will use manual review process only.
> To enable, set `coderabbit_integration.enabled: true` in core-config.yaml.

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-02-12 | 1.0 | Story created from epic section with architecture context | @sm |

## Dev Agent Record
### Agent Model Used
GPT-5 Codex

### Debug Log References
- `npm install --workspace @flix/web`
- `npm run test --workspace @flix/web`
- `npm run build --workspace @flix/web`
- `npm run test --workspace @flix/api`

### Completion Notes List
- Migrated `apps/web` from placeholder scripts to Vite + React runtime with `react-router-dom`.
- Implemented learner catalog flow consuming `POST /api/public/events/:eventSlug/catalog`.
- Implemented access-check and playback flow with access key retries:
  - `POST /api/public/events/:eventSlug/lessons/:lessonSlug/access-check`
  - `POST /api/public/events/:eventSlug/lessons/:lessonSlug/playback`
- Added clear learner messaging for private/locked/expired lesson states.
- Added playback screen with previous/next navigation links based on API response.
- Added unit tests for request payload/headers behavior in web API client.

### File List
- `apps/web/package.json`
- `apps/web/index.html`
- `apps/web/vite.config.js`
- `apps/web/.env.example`
- `apps/web/src/main.jsx`
- `apps/web/src/App.jsx`
- `apps/web/src/pages/CatalogPage.jsx`
- `apps/web/src/pages/PlaybackPage.jsx`
- `apps/web/src/services/api.js`
- `apps/web/src/services/api.test.js`
- `apps/web/src/test/setup.js`
- `apps/web/src/styles.css`
- `apps/web/src/README.md`
- `package-lock.json`

## QA Results
PASS

- Web workspace unit tests passed (`2` tests).
- Web workspace build succeeded (Vite production build).
- API workspace regression tests passed (`31` tests), no breakages introduced by web runtime integration.
