# Story 8.3: Browser E2E Smoke and CI Quality Gate Expansion

## Status
Done

## Executor Assignment
executor: "@devops"
quality_gate: "@architect"
quality_gate_tools: ["manual-review"]

## Story
**As a** delivery team,  
**I want** browser-level smoke automation integrated into readiness gates,  
**so that** regressions in real user journeys are blocked before release.

## Acceptance Criteria
1. E2E smoke suite covers core admin and learner happy paths in browser runtime.
2. CI/release gate includes frontend build checks and E2E smoke execution.
3. Gate fails explicitly on critical flow breakage with actionable diagnostics.

## Tasks / Subtasks
- [x] Task 1 (AC: 1) E2E smoke suite covers core admin and learner happy paths in browser runtime.
  - [x] Implement technical changes required for AC 1
  - [x] Add validation/tests for AC 1
- [x] Task 2 (AC: 2) CI/release gate includes frontend build checks and E2E smoke execution.
  - [x] Implement technical changes required for AC 2
  - [x] Add validation/tests for AC 2
- [x] Task 3 (AC: 3) Gate fails explicitly on critical flow breakage with actionable diagnostics.
  - [x] Implement technical changes required for AC 3
  - [x] Add validation/tests for AC 3

## Dev Notes
### Previous Story Insights
- Use previous completed story notes when available.

### Data Models
- Use the domain entities from architecture shards when applicable to this story.
  [Source: docs/architecture/data-models.md#Data Models]

### API Specifications
- Follow REST contracts and endpoint boundaries from API specification shards.
  [Source: docs/architecture/api-specification.md#API Specification]

### File Locations
- Respect monorepo boundaries (`apps/web`, `apps/admin`, `services/api`, `packages/design-system`).
  [Source: docs/architecture/unified-project-structure.md#Unified Project Structure]

### Technical Constraints
- Keep implementation aligned with selected stack and architecture patterns.
  [Source: docs/architecture/tech-stack.md#Tech Stack]
  [Source: docs/architecture/high-level-architecture.md#High Level Architecture]

### Service Specifications
- Follow backend module organization and auth/security middleware patterns.
  [Source: docs/architecture/backend-architecture.md#Backend Architecture]
  [Source: docs/architecture/security-and-performance.md#Security and Performance]

- Story source: docs/prd/epic-8-ai-branding-and-release-closure.md

## Testing
- Follow test pyramid and organization from architecture testing strategy.
  [Source: docs/architecture/testing-strategy.md#Testing Strategy]
- Add/update unit tests for new business logic.
- Add/update integration tests for modified API flows when applicable.
- Ensure critical journey impact is considered for E2E smoke coverage.

## ðŸ¤– CodeRabbit Integration

> **CodeRabbit Integration**: Disabled
>
> CodeRabbit CLI is not enabled in `core-config.yaml`.
> Quality validation will use manual review process only.
> To enable, set `coderabbit_integration.enabled: true` in core-config.yaml.

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-02-12 | 1.0 | Story created from epic section with architecture context | @sm |

## Dev Agent Record
### Agent Model Used
GPT-5 Codex

### Debug Log References
- `npm run e2e:smoke`
- `npm run e2e:smoke:gate`
- `npm run build --workspace @flix/web`
- `npm run build --workspace @flix/admin`
- `npm run release:readiness`

### Completion Notes List
- Added Playwright browser smoke setup with runtime orchestration for API + admin + learner apps.
- Added learner smoke scenario covering catalog-to-playback critical journey.
- Added admin smoke scenario covering browser login and event creation.
- Added CI workflow (`.github/workflows/ci-quality-gate.yml`) executing frontend builds and E2E smoke gate on PR/push to `main`.
- Added explicit E2E gate script with actionable diagnostics (`playwright-report`, `test-results`, rerun command) on failure.
- Expanded release readiness gate to enforce:
  - browser smoke gate;
  - frontend production builds;
  - API integration regression checks.

### File List
- `.github/workflows/ci-quality-gate.yml`
- `.gitignore`
- `e2e/playwright.config.mjs`
- `e2e/tests/admin-smoke.spec.mjs`
- `e2e/tests/learner-smoke.spec.mjs`
- `package.json`
- `package-lock.json`
- `scripts/e2e-smoke-gate.mjs`
- `scripts/release-readiness-gate.mjs`
- `README.md`
- `docs/stories/8.3.story.md`

## QA Results
PASS

- Browser smoke suite passed (`2` tests, chromium):
  - admin login + create event
  - learner catalog + playback navigation
- Frontend builds passed for both apps (`@flix/web`, `@flix/admin`).
- `release:readiness` gate passed with final status `GO`.
